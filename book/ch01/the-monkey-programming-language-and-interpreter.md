# Monkey 编程语言和解释器

每一个解释器都是为特定的编程语言设计的，如果没有编译器或者解释器，任何一种编程语言仅仅是一些特定符号组合而已。

我们为设计的编程语言起名叫 `Monkey`, 它包含的语言特性如下：

- `C` 语言类似语法
- 变量绑定
- 整型和布尔型
- 算术表达式
- 内置函数
- 高阶函数
- 闭包
- 字符串类型
- 数组
- 哈希字典

接下来这本书我们将一步步实现上述功能，首先我们先看看 `Monkey` 语言是什么样子。

在 `Monkey` 中，我们可以将值绑定到变量上：

```monkey
let age = 1;
let name = "Monkey";
let result = 10 * (20 /2);
```

除了整型、布尔型和字符串类型，我们的 `Monkey` 语言同样也支持数组和哈希字典，下面看看是如何使用它们：

```monkey
let myArray = [1, 2, 3, 4, 5];
let thorsten = {"name": "Thorsten", "age": 28};
```

可以使用索引和哈希字典中的键访问各自的元素

```monkey
myArray[0]  // => 1
thorsten["name"] // => "Thorsten"
```

`let` 语句可将函数绑定到变量上，下面的例子是将加法函数绑定到变量上

```monkey
let add = fn(a, b) { return a + b; }
```

`Moneky` 还支持不仅仅支持 `return` 语句，还支持隐式返回值，也就是说我们可以不使用 `return` 直接返回。

```monkey
let add = fn(a, b) { a + b; }
```

调用函数函数也非常简单

```monkey
add(1, 2); // => 3
```

接下来展示更复杂函数的例子，比如 `fibonacci` 函数可以返回第 `N` 个斐波那契数。

```monkey
let fibonacci = fn(x){
    if (x == 0) {
        0
    } else {
        if (x == 1) {
            1
        } else {
            fibonacci(x - 1) + fibonacci(x - 2);
        }
    }
};
```

可以看到我们是递归调用 `fibonacci` 函数。

`Monkey` 还支持一种特殊类型函数，叫高阶函数，这写函数能够使用其他函数为参数，下面就是例子

```monkey
let twice = fn(f, x) {
    return f(f(x))
};
let addTwo = fn(x) {
    return x + 2
};
twice(addTwo, 2); // => 6
```

在这里 `twice` 函数接受两个参数：一个叫做 `addTwo` 的函数，另一个是整数 `2`。它调用 `addTwo` 函数两次，第一次用 `2` 作为参数，第二次用第一次调用的返回值作为参数，最终的结果为 `6`。

所以，在 `Monkey` 中可以将函数作为函数调用的参数，函数在 `Monkey` 中也就是值，跟整数和字符串一样，这种功能叫做函数是一等公民。

本书我们将完成的解释器会实现上述的全部功能，在 `REPL` 中，它首先读取源代码中的 `token`，然后解析它，构建出一棵内部表达抽象语法树，最后计算这棵树，它拥有以下主要成分：

- 词法解析器
- 语法解析器
- 抽象语法树
- 内部计算对象
- 执行器

我们会从上到下按照这个顺序完成各个部分，按照源代码到最终结果输出的流程，这个方法的缺点就是我们不能在第一章结束的时候完成一个 `Hello World`，但是我们能够理解上述的成分是如何相互配合工作的，数据流是如何流动的。
